`timescale 1ns / 1ps
//////////////////////////////////////////////////////////////////////////////////
// Company: 
// Engineer: 
// 
// Create Date: 02/23/2021 11:07:39 PM
// Design Name: 
// Module Name: I2cLcd
// Project Name: 
// Target Devices: 
// Tool Versions: 
// Description: 
// 
// Dependencies: 
// 
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
// 
//////////////////////////////////////////////////////////////////////////////////


module I2cLcd #(
    parameter ClockingRatio = 250,
    parameter ClockingRatioLength = 8,
    parameter Address = 7'h27
) (
    output SDA,
    output SCL,
    output Running,
    
    input SystemClock,
    input Reset
);
    reg trigger;
    reg running;
    reg [7:0] data;
    
    assign Running = running;

    I2cWriteByte #(
        .ClockingRatio(ClockingRatio),
        .ClockingRatioLength(ClockingRatioLength)
    ) i2cWriter (
        .SDA(SDA),
        .SCL(SCL),
        .Running(running),
        
        .SystemClock(SystemClock),
        .Reset(Reset),
        .Trigger(trigger),
        .Address(Address),
        .Data(data)
    );
    
    enum {
    /*
    0: Running/!Stopped
    1: High/!Low Nibble
    2: Confirm/!Send
    3: Enable/!Disabled
    */
    
        IDLE    = 3'b0000,
        
        SH      = 3'b0011,
        SHE     = 3'b1011,
        SHA     = 3'b0111,
        
        SL      = 3'b0001,
        SLE     = 3'b1001,
        SLA     = 3'b0101,
        
        Complete =3'b0110        
    } writeMachine;
        
    /*
        Write command is 
        High nibble, High nibble + Enable, High Nibble
        Low nibble, Low nibble + Enable, Low Nibble
    */
    /*
        required commands:
            init screen
            postion text
            toggle cursor
            postion cursor
            write text ??? streams ???
            clear screen
    */

    /*
Value (Hex)	Toggle Enable	Wait Count	Nibble
0	No	4000	X
30	Yes	18	H
30	Yes	18	L
30	Yes	1	H
20	Yes	1	L
20	Yes	1	H
80	Yes	1	L
00	Yes	1	H
c0	Yes	1	L
00	Yes	1	H
01	Yes	1	L
00	Yes	1	H
60	Yes	1	L
00	Yes	1	H
20	Yes	1	L
08	Yes	1	H
10	Yes	1	L
    
        init sequence from arduino
Address	Message	Delay (s)	Delay (ms)	Delay (us)	Message 	Message to bits formatted
0x27	0x00	1.00081	    1000.81	    1000810	    00000000	8'b0000_0000
----------------------------------------------------------------------------
0x27	0x30	0.000228	0.228	    228	        00110000	8'b0011_0000
0x27	0x34	0.00023	    0.23	    230	        00110100	8'b0011_0100
0x27	0x30	0.004808	4.808	    4808	    00110000	8'b0011_0000

0x27	0x30	0.000234	0.234	    234	        00110000	8'b0011_0000
0x27	0x34	0.00023	    0.23	    230	        00110100	8'b0011_0100
0x27	0x30	0.004808	4.808	    4808	    00110000	8'b0011_0000
----------------------------------------------------------------------------
0x27	0x30	0.00023	    0.23	    230		    00110000	8'b0011_0000
0x27	0x34	0.000228	0.228	    228		    00110100	8'b0011_0100
0x27	0x30	0.00043		0.43	    430		    00110000	8'b0011_0000

0x27	0x20	0.00023	    0.23	    230		    00100000	8'b0010_0000
0x27	0x24	0.00023		0.23	    230		    00100100	8'b0010_0100
0x27	0x20	0.000284	0.284	    284	        00100000	8'b0010_0000
----------------------------------------------------------------------------
0x27	0x20	0.00023		0.23	    230	        00100000	8'b0010_0000
0x27	0x24	0.00023	    0.23	    230	        00100100	8'b0010_0100
0x27	0x20	0.00028		0.28	    280	        00100000	8'b0010_0000

0x27	0x80	0.00023		0.23	    230	        10000000	8'b1000_0000
0x27	0x84	0.00023	    0.23	    230	        10000100	8'b1000_0100
0x27	0x80	0.000284    0.284	    284	        10000000	8'b1000_0000
----------------------------------------------------------------------------
0x27	0x00	0.00023	    0.23	    230	        00000000	8'b0000_0000
0x27	0x04	0.00023	    0.23	    230	        00000100	8'b0000_0100
0x27	0x00	0.000284	0.284	    284	        00000000	8'b0000_0000

0x27	0xC0	0.00023	    0.23	    230	        11000000	8'b1100_0000
0x27	0xC4	0.00023	    0.23	    230	        11000100	8'b1100_0100
0x27	0xC0	0.000284	0.284       284	        11000000	8'b1100_0000
----------------------------------------------------------------------------
0x27	0x00	0.00023		0.23	    230	        00000000	8'b0000_0000
0x27	0x04	0.00023	    0.23	    230	        00000100	8'b0000_0100
0x27	0x00	0.00028	    0.28	    280	        00000000	8'b0000_0000

0x27	0x10	0.00023		0.23	    230	        00010000	8'b0001_0000
0x27	0x14	0.000228	0.228	    228	        00010100	8'b0001_0100
0x27	0x10	0.002296	2.296	    2296        00010000	8'b0001_0000
----------------------------------------------------------------------------
0x27	0x00	0.00023		0.23	    230	        00000000	8'b0000_0000
0x27	0x04	0.00023	    0.23	    230	        00000100	8'b0000_0100
0x27	0x00	0.00028	    0.28	    280	        00000000	8'b0000_0000

0x27	0x60	0.00023		0.23	    230	        01100000	8'b0110_0000
0x27	0x64	0.000234	0.234	    234	        01100100	8'b0110_0100
0x27	0x60	0.000286	0.286	    286	        01100000	8'b0110_0000
----------------------------------------------------------------------------
0x27	0x00	0.000228	0.228	    228	        00000000	8'b0000_0000
0x27	0x04	0.00023		0.23	    230	        00000100	8'b0000_0100
0x27	0x00	0.00029	    0.29	    290	        00000000	8'b0000_0000

0x27	0x20	0.00023	    0.23	    230	        00100000	8'b0010_0000
0x27	0x24	0.00023		0.23	    230	        00100100	8'b0010_0100
0x27	0x20	0.00229		2.29	    2290        00100000	8'b0010_0000
----------------------------------------------------------------------------
0x27	0x08	0.00024	    0.24	    240	        00001000	8'b0000_1000 //turn on backlight ... not needed
----------------------------------------------------------------------------
0x27	0x08	0.00023	    0.23	    230	        00001000	8'b0000_1000
0x27	0x0C	0.00023		0.23	    230	        00001100	8'b0000_1100
0x27	0x08	0.00028	    0.28	    280	        00001000	8'b0000_1000

0x27	0x18	0.000228	0.228	    228	        00011000	8'b0001_1000
0x27	0x1C	0.00023	    0.23	    230	        00011100	8'b0001_1100
0x27	0x18	0.000228	0.228	    228	        00011000	8'b0001_1000
----------------------------------------------------------------------------  
    */
endmodule
